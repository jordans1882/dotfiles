var g_extensionid=chrome.i18n.getMessage("@@extension_id");var g_readerurl="http://pdfviewer.softgateon.net/";var storagedefault={enable_sel_context:[true,0],enable_link_context:[true,0],enable_page_context:[true,0],reader_opentype:[3,0],reader_opentype2:[3,0],other_newtablast:[false,0],};function setStorageDefaults2(a){var b=localStorage[a];if((b==null)||(b=="undefined")){localStorage[a]=storagedefault[a][0]}}function setStorageDefaults_int(a){var b=localStorage[a];if((b==null)||isNaN(parseInt(b))||(b=="undefined")){localStorage[a]=storagedefault[a][0]}}function getStorageDefaults(a){return storagedefault[a][0]}function setStorageDefaults(){for(var b in storagedefault){if(storagedefault[b][1]==1){setStorageDefaults_int(b)}else{setStorageDefaults2(b)}}}try{setStorageDefaults()}catch(err){}var manifest;function getmanifest(){var a=new XMLHttpRequest();a.open("GET",chrome.extension.getURL("manifest.json"),false);a.onload=function(){manifest=JSON.parse(a.responseText)};a.send(null)}getmanifest();function proc_init(){}function update_contextmenu(){try{chrome.contextMenus.removeAll(function(){});if(toBool(localStorage.enable_sel_context)){chrome.contextMenus.create({type:"normal",title:chrome.i18n.getMessage("msg_makeqrcodetext"),contexts:["selection"],onclick:proc_context1_click})}if(toBool(localStorage.enable_link_context)){chrome.contextMenus.create({type:"normal",title:chrome.i18n.getMessage("msg_makeqrcodelink"),contexts:["link"],onclick:proc_context2_click})}if(toBool(localStorage.enable_page_context)){chrome.contextMenus.create({type:"normal",title:chrome.i18n.getMessage("msg_openreader"),contexts:["page"],onclick:function(){proc_context4_click(1)}})}chrome.contextMenus.create({type:"normal",title:chrome.i18n.getMessage("msg_makeqrcodepage"),contexts:["all"],onclick:proc_context2_click,documentUrlPatterns:["*://*/*.pdf*","*://*/*.PDF*","*://*/*.Pdf*"]})}catch(a){}}proc_init();update_contextmenu();function proc_context1_click(d,b){try{var a=trim(d.selectionText);if(!a){alert(_i18n("msg_notselected"));return}if(!isurl_links(a)){alert(_i18n("msg_notlink"));return}a=get_readerurl()+proc_cleanurl(a,true);proc_open(a)}catch(c){}}function proc_context2_click(d,b){try{var a=d.linkUrl;if(a==undefined){a=b.url}if(a==undefined){a=""}if(!a){a=get_readerurl(true)}else{if(!isurl_links(a)){alert(_i18n("msg_notlink"));return}a=get_readerurl()+proc_cleanurl(a,true)}proc_open(a)}catch(c){}}function proc_context4_click(b){if(b==1){var a=get_readerurl(true);open_newtab(a,false)}else{if(b==2){open_newtab_extension("options.html",false)}}}function proc_open(c,a){if(!a){a="reader_opentype"}var b=localStorage[a];if(b==0){open_newtab(c,false)}else{if(b==2){chrome.windows.create({url:c})}else{if(b==3){chrome.windows.getLastFocused(function(e){var d=e.id;chrome.tabs.getSelected(d,function(f){chrome.tabs.update(f.id,{url:c})})})}else{open_newtab_exist(c,false,true)}}}}function get_readerurl(a){if(!a){return g_readerurl+"?file="}else{return g_readerurl}}function isPdfFile(a){if(a.toLowerCase().indexOf(".pdf")>0){return true}}chrome.browserAction.onClicked.addListener(function(b){var a;if(!isurl_links(b.url)){a=get_readerurl(true)}else{a=get_readerurl()+proc_cleanurl(b.url,true)}proc_open(a,"reader_opentype2")});function proc_cleanurl2(c){if(!c){c=""}var a=c.match(/http(s?):\/\/www.google.(.*?)\/url\?(.*?)&url=(.*?)&/i);if(a&&a[4]){a[4]=decodeURIComponent(a[4]);if(isurl_links(a[4])){return a[4]}}var a=c.match(/http(s?):\/\/r.search.yahoo.com\/(.*?)\/RU=(.*?)\/RK/i);if(a&&a[3]){a[3]=decodeURIComponent(a[3]);if(isurl_links(a[3])){return a[3]}}if(c==get_readerurl(true)||c==get_readerurl()){return""}var b=new RegExp(regex_decode(get_readerurl())+"(.*?)$","i");var a=c.match(b);if(a&&a[1]){if(isurl_links(a[1])){return a[1]}}return c}function proc_cleanurl(c,a){var b=proc_cleanurl2(c);return b}var objurls=[];function proc_checkxhr(){for(var a=objurls.length-1;a>=0;a--){var c=now-objurls[a].time;if(c>0&&c/1000/60>10){try{if(objurls[a].url){window.URL.revokeObjectURL(objurls[a].url)}}catch(b){}objurls.splice(a,1)}}}function proc_getblob(c,b,a){c.surl=proc_cleanurl(c.surl);var d=new XMLHttpRequest();d.open("GET",c.surl,true);d.responseType="blob";d.onprogress=function(e){var f={type:"progress",loaded:e.loaded,position:e.position,total:e.total,totalSize:e.totalSize,surl:c.surl,guniq:c.guniq};chrome.tabs.sendRequest(b.tab.id,f,null)};d.onload=function(j){if(this.status==200||c.surl.lastIndexOf("file:",0)===0){var g=this.response;function i(){var e=window.URL.createObjectURL(g);var l={};l.url=e;l.time=(new Date()).getTime();objurls.push(l);var m={type:"send_blob_file",bloburl:e,surl:c.surl,guniq:c.guniq};chrome.tabs.sendRequest(b.tab.id,m,function(){for(var n=objurls.length-1;n>=0;n--){if(objurls[n].url==l.url&&objurls[n].time==l.time){try{if(objurls[n].url){window.URL.revokeObjectURL(objurls[n].url)}}catch(o){}objurls.splice(n,1);break}}})}if(!a&&g.type=="text/html"&&g.size<5000){var f=new window.FileReader();f.readAsText(g);f.onloadend=function(){var e=(f.result||"").match(/<meta(.*?)http-equiv="refresh"(.*?)url=('|")(.*?)('|")(.*?)>/i);if(e&&isurl_links(e[4]||"")){c.surl=e[4];proc_getblob(c,b,true)}else{i()}}}else{i()}}else{var h="Error (status) "+this.status+"("+this.statusText+") occurred while receiving the document.";var k={type:"send_blob_file",error:h,surl:c.surl,guniq:c.guniq};chrome.tabs.sendRequest(b.tab.id,k,null)}};d.onerror=function(g){var f="Error (proc_getblob) "+g.target.status+" occurred while receiving the document.";if(c.surl.lastIndexOf("file:",0)===0){f+="\n\nPlease check the access permissions for the file URL."}var h={type:"send_blob_file",error:f,surl:c.surl,guniq:c.guniq};chrome.tabs.sendRequest(b.tab.id,h,null)};d.send()}chrome.extension.onRequest.addListener(function(c,b,a){switch(c.type){case"get_blob_file":proc_getblob(c,b);a();break;case"get_blob_cancel":a();break;case"test":if(manifest){c.version=manifest.version}a(c);break;default:a();break}});function check_data(e){try{var d=new Date();var b=localStorage.extension_lastcheck;var a=false;if(b>0){if((d.getTime()-b)/1000/60/60>72){a=true}}else{if(b==-1){localStorage.extension_lastcheck=d.getTime()}else{a=true;setTimeout(function(){open_newtab_extension("options.html",true)},700)}}if(a){localStorage.extension_lastcheck=d.getTime()}}catch(c){}}check_data(true);setInterval(function(){proc_checkxhr()},1000*60*5);